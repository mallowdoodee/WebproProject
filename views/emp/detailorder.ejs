<style>
    /* body {
        background-color: #F0E9E9;
    } */
    
    .container {
        width: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: 20px;
        box-sizing: border-box;
    }

    #accept,
    #decline, .cancel {
        padding: 8px 14px;
        color: white;
        cursor: pointer;
        border-radius: 5px;
        transition: opacity 0.3s ease;
        font-family: var(--font-thai);
    }

    #accept {
        /*border: 1px solid #67C14B;*/
        background-color: #67C14B;
        margin-right: 6px;
    }

    #decline {
        background-color: #BF3F3F;
        /*border: 1.5px solid #BF3F3F;*/
        margin-right: 6px;
    }

    .cancel {
        background-color: #D8A273;
        display: inline-block;
    }

    #accept:hover,
    #decline:hover, .cancel:hover {
        opacity: 0.8;
    }

    .modal-container {
        display: none;
        width: 100%;
        max-width: 50%;
        height: 270px;
        background-color: #ffffff;
        padding: 30px;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        box-shadow: 0px 1px 10px rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        z-index: 10000;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
    }

    .btn {
        background-color: #ff4d4d;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        font-size: 16px;
        border-radius: 5px;
    }

    .send, 
    .close {
        border-radius: 2px;
        font-family: var(--font-thai);
        color: white;
    }

    .send {
        background-color: #88C974;
        padding: 5px 7px;
    }

    .close {
        background-color: #D15F5F;
        padding: 5px;
    }

    .send:hover {
        background-color: #67C14B;
    }

    .close:hover {
        background-color: #C14E4E;
    }

    /* .modal-container form {
        margin-top: 30px;
    } */

    textarea {
        width: 100%;
        height: 140px;
        border: 1px solid gray;
        resize: none;
        margin-bottom: 15px;
        margin-top: 5px;
    }

    .list-order {
        background: #fff;
        padding: 40px;
        border-radius: 4px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .order-title {
        color: #580201;
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 15px;
    }

    .status {
        font-weight: bold;
        font-family: var(--font-thai);
    }

    .section {
        margin-bottom: 20px;
        background: #FAF0EE;
    }

    h4 {
        background: #F6E5E2;
        padding: 10px;
        padding-left: 15px;
        border-radius: 5px;
        font-size: 18px;
        font-family: var(--font-logo);
        font-weight: 500;
        color: #580201;
    }

    p {
        margin: 7px 10px;
        font-family: var(--font-secondary);
        color: #B8625C;
    }

    hr {
        border: 0;
        height: 1px;
        background: #E5CFC5;
        margin: 20px 0;
    }

    .material-box,
    .pendant-box {
        background: #FAF0EE;
        padding: 10px;
        border-radius: 5px;
    }

    .pendant-item {
        border-bottom: 1px solid #ddd;
        padding: 10px;
        font-family: var(--font-thai);
    }

    .pendant-item:last-child {
        border-bottom: none;
    }


    /* .list-order {
        background: #fff;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 0 10px 10px rgba(142, 142, 142, 0.1);
        margin-bottom: 40px;
    } */

    h2, h3 {
        text-align: center;
        font-family: var(--font-secondary);
    }

    h2 {
        text-align: center;
        color: #8F3B30;
        margin-bottom: 10px;
        font-weight: 400;
    }

    h3 {
        color: rgb(120, 120, 120);
    }


    /* .list-content {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    } */

    /* .list-content li {
        list-style: none;
        padding: 10px;
        background: #f9f9f9;
        border-radius: 5px;
    }  */


    /* .pendant-list {
        grid-column: span 2;
        background: #eef7ff;
        padding: 10px;
        border-radius: 5px; 
    } */

    .info-order {
        display: grid;
        align-items: center;
    }

    .pendant-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 5px 0;
    } 

    .form-container {
        max-width: 100%;
        margin-top: 30px;
        padding: 20px;
        background: #fff;
        border-radius: 4px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    label {
        margin-top: 10px;
        font-weight: bold;
        color: #8F3B30;
    }

    input[type="text"], input[type="number"] {
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ddd;
        border-radius: 5px;
        margin-right: 15px;
    }

    button {
        margin-top: 20px;
        padding: 10px;
        background: #EDD1CC;
        color: 580201;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-right: 10px;
    }

    button:hover {
        background: #F6E5E2;
    }

    .delivery {
        margin-top: 20px;
        padding: 10px;
        background: #3398ff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-right: 10px;
    }

    .delivery:hover {
        background: #66aaff;
    }

    /* form {
        display: flex;
        flex-direction: column;
    } */

    .img-preview {
        display: block;
        width: 50%;
        margin-top: 15px;
        border-radius: 5px;
    }

    input[type="color"] {
        border: none;
        cursor: pointer;
    }

    #add-list li {
        background: #FAF0EE;
        border-radius: 0;
        grid-column: span 2;
        padding: 10px;
        cursor: pointer;
        font-family: var(--font-thai);
        color: #B8625C;
        margin-top: -20px;
        margin-bottom: 10px;
    }

    #add-list li::marker {
        font-size: 12px;
        font-family: var(--font-thai);
        color: #B8625C;
    }

    .add-item {
        display: flex;
        align-items: center;
        background-color: #ffe4e1;
    }

    .form-container, .butt {
        text-align: center;
        font-family: var(--font-thai);
    }

    /* .list-check {
        display: flex;
        align-items: center;
        gap: 20px;
    } */

    /* .check-item {
        display: flex;
        flex-direction: column;
        gap: 10px;
    } */

    /* .img-payment {
        max-width: 30%;
        height: auto;
        border-radius: 5px;
    } */

    .info-order {
        background: #fff;
        padding: 20px;
        border-radius: 4px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin-top: 40px;
    }

    .list-check {
        display: flex;
        /* flex-direction: column; */
        align-items: center;
    }

    .img-payment {
        max-width: 25%;
        border-radius: 5px;
        margin-right: 15px;
    }

    .check-item {
        width: 100%;
    }

    .check-item label {
        display: block;
        background: #FAF0EE;
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
        transition: 0.3s;
        cursor: pointer;
        font-family: var(--font-thai);
    }

    .check-item label:hover {
        background: #EDD1CC;
    }

    .pending {
        color: #E0B068;
    }

    .accepted {
        color: #88C974;
    }

    .declined {
        color: #D15F5F;
    }

    .recived {
        color: #3398ff;
    }

    #total {
        margin-top: 30px;
        font-size: 30px;
    }

    #description {
        padding-left: 4px;
    }

    #acceptButton {
        color: white;
        background-color: #67C14B;
        margin-right: 10px;
    }

    #acceptButton:hover {
        background-color: #88C974;
    }

    /*.status {
        color: #007bff;
        font-weight: bold;
    }*/

</style>

<div class="container">
    <div class="list-order" id="list-order">
        <h2>Order Details</h2>
        <%if(data[0].order_status === 'กำลังจัดส่ง' || data[0].order_status === 'จัดส่งสำเร็จ'){%>
            <h3 class="order-title">#ORDER<%= data[0].id %> - <%= data[0].order_status %><span class="status"> #<%=data[0].parcel_number%></span></h3>
        <%}else{%>
            <h3 class="order-title">#ORDER<%= data[0].id %> - <span class="status 
                <%= data[0].order_status === 'รอดำเนินการ' ? 'pending' 
                : data[0].order_status === 'ยอมรับออเดอร์แล้ว' ? 'accepted' 
                : data[0].order_status === 'รอตรวจสอบการชำระเงิน' ? 'pending' 
                : data[0].order_status === 'รับออเดอร์' ? 'recived' 
                : 'declined' %>">
                <%= data[0].order_status %></span></h3>
        <%}%>

        <div class="list-content" id="list">
            <!-- Material Section -->
            <div class="section">
                <h4>Material Details</h4>
                <div class="material-box">
                    <p><strong>Material:</strong> <%= order.material.name %></p>
                    <p>
                        <strong>Color of Material:</strong>
                        <input type="color" value="<%= order.material.color_material %>" disabled>
                    </p>
                    <% if (order.material.engraveMaterialText) { %>
                        <p><strong>Engrave on Material:</strong> <%= order.material.engraveMaterialText %></p>
                    <% } %>
                </div>
            </div>

            <hr>

            <!-- Stone Section -->
            <div class="section">
                <h4>Stone Details</h4>
                <div class="material-box">
                    <p><strong>Stone:</strong> <%= order.stone %></p>
                </div>
            </div>

            <hr>

            <!-- Ring Size -->
            <% if (data[0].category === 'แหวน') { %>
                <div class="section">
                    <h4>Ring Size</h4>
                    <div class="material-box">
                        <p><strong>Size:</strong> <%= order.size %></p>
                    </div>
                </div>
            <% } %>

            <!-- Bracelet Pendant List -->
            <% if (data[0].category === 'สร้อยข้อมือ') { %>
                <div class="section">
                    <h4>Pendants</h4>
                    <div class="pendant-box">
                        <% order.pendant.forEach((item) => { %>
                            <div class="pendant-item">
                                <li><strong>ชื่อสินค้า:</strong> <%= item.name %></li>
                                <li><strong>จำนวน:</strong> <%= item.amount %> ชิ้น</li>
                                <li>
                                    <strong>สี:</strong>
                                    <input type="color" value="<%= item.color_pendant %>" disabled>
                                </li>
                                <% if (item.engravePendantText) { %>
                                    <li><strong>สลักชื่อ:</strong> <%= item.engravePendantText %></li>
                                <% } %>
                            </div>
                        <% }); %>
                    </div>
                </div>
            <% } %>

            <div class="section">
                <h4>Description</h4>
                <div class="material-box">
                    <p> <%= order.description || '-' %></p>
                </div>
            </div>

            <hr>
            
            <%if (data[0].order_status === 'ปฏิเสธการรับออเดอร์') {%>
                <div class="section">
                    <h4 class="font-thai">เหตุผลที่ยกเลิก:</h4>
                    <div class="material-box">
                        <p class="font-thai"><%=data[0].decline_reason%></p>
                    </div>
                </div>
            <%}else{%>
                <div class="section">
                    <h4>Add More</h4>
                </div>
            <%}%>
            <div id="add-list">
                <% if (data[0].order_status !== 'รอดำเนินการ') {%>
                    <% if (Array.isArray(add.add_order) && add.add_order.length > 0) { %>
                        <% add.add_order.forEach((item) => { %>
                            <div class="add-item">
                                <li><span><strong>ชื่อสินค้า:</strong> <%= item.name %></span></li>
                                <li><span><strong>จำนวน</strong> <%= item.amount %></span></li>
                                <li><span><strong>ราคา:</strong> <%= item.price %></span></li>
                            </div>
                        <% }); %>
                    <%}%>
                <% } %>
            </div>
            <% if (order.refImage) { %>
                <img src="/<%= order.refImage %>" alt="Reference Image" class="img-preview">
            <% } %>
        </div>

    </div>
    <!-- image -->
    <!-- description -->
    <!-- ชื่อสินค้า-ราคา-ok -->
    <%if (data[0].order_status === 'รอดำเนินการ') {%>
    <div class="form-container">
        <h2>Add more</h2>
        <form action="#" id="productForm">
            <label for="productName">ชื่อสินค้า:</label>
            <input type="text" id="productName" placeholder="กรอกชื่อสินค้า" required>

            <label for="price">ราคา:</label>
            <input type="number" id="price" min="0" placeholder="0" required>

            <label for="quantity">จำนวน:</label>
            <input type="number" id="quantity" min="1" placeholder="1" required>

            <button type="button" onclick="add()">เพิ่มข้อมูลสินค้า</button>
        </form>
    </div>

        <!-- total price -->
        <div id="total-container">
            <h2 id="total">Total: <%= order.total %> Baht</h2>
        </div>

        <!-- ปุ่ม access/decline -->
        <div class="butt">
            <button onclick="accept()" id="accept">ยอมรับออเดอร์</button>
            <button id="decline" onclick="open_decline_Modal()">ปฏิเสธรับออเดอร์</button>
            <a href="/emp/orders" class="cancel">กลับไปหน้าหลัก</a>
        </div>
            <!-- decline => description -->
        <div class="modal" id="modal-decline">
            <div class="modal-container" id="modal-decline-container">
                <form>
                    <label class="font-thaiS">เหตุผลที่ยกเลิก</label>
                    <textarea id="description" placeholder="Enter something..."></textarea>

                    <a class="send" onclick="send_decline_Modal()">ยืนยัน</a>
                    <a class="close" onclick="close_decline_Modal()">ย้อนกลับ</a>
                </form>
            </div>
        </div>
    <%};%>


    <!-- <input type="hidden" id="payment_status" value="<%= data[0].payment_status %>">     -->
    <%if (data[0].order_status !== 'ยอมรับออเดอร์แล้ว' && data[0].order_status !== 'รอดำเนินการ' && data[0].order_status !== 'ปฏิเสธการรับออเดอร์') {%>
        <div class="info-order">
            <h2>Payment</h2>
            <div class="list-check">
                <img src="/<%= data[0].payment_image %>" alt="Receipt Image" class="img-payment">
                <%if (data[0].payment_status === "paid") {%>
                    <div class="check-item">
                        <label><input type="checkbox" class="check" checked disabled> ตรวจสอบ ชื่อบัญชีปลายทาง</label>
                        <label><input type="checkbox" class="check" checked disabled> ตรวจสอบ จำนวนเงิน</label>
                        <label><input type="checkbox" class="check" checked disabled> ตรวจสอบ ยอดเงินเข้าบัญชี</label>
                        <label><input type="checkbox" class="check" checked disabled> ตรวจสอบ เวลาที่ทำรายการ</label>
                        <label><input type="checkbox" class="check" checked disabled> ตรวจสอบ เลขที่อ้างอิง (Ref No.)</label>
                    </div>
                <%}else{%>
                    <div class="check-item">
                        <label><input type="checkbox" class="check"> ตรวจสอบ ชื่อบัญชีปลายทาง</label>
                        <label><input type="checkbox" class="check"> ตรวจสอบ จำนวนเงิน</label>
                        <label><input type="checkbox" class="check"> ตรวจสอบ ยอดเงินเข้าบัญชี</label>
                        <label><input type="checkbox" class="check"> ตรวจสอบ เวลาที่ทำรายการ</label>
                        <label><input type="checkbox" class="check"> ตรวจสอบ เลขที่อ้างอิง (Ref No.)</label>
                    </div>
                </div>
                <div class="butt">
                    <button id="acceptButton" style="display: none;" onclick="payment_check()">ยืนยันรับออเดอร์</button>
                    <a href="/emp/myorders" class="cancel">กลับไปหน้าหลัก</a>
                </div>
            <%}%>
        </div>
    <%};%>
</div>
<div>
    <%if(data[0].order_status === 'ยอมรับออเดอร์แล้ว') {%>
    <div class="butt">
        <a href="/emp/myorders" class="cancel">กลับไปหน้าหลัก</a>
    </div>
    <%}%>
</div>
<%if (data[0].order_status === 'รับออเดอร์') {%>
    <div class="info-order" style="justify-content: center;">
        <h2>Delivery</h2>
        <div class="post">
            <label class="font-thaiS">กรอกหมายเลขพัสดุ: <input type="text" id="delivery"></label>
        </div>
        <div class="butt">
            <button onclick="delivery(event)" class="delivery">จัดส่งสินค้า</button>
            <a href="/emp/myorders" class="cancel">กลับไปหน้าหลัก</a>
        </div>
    </div>
<%}%>
<div>
    <%if(data[0].order_status === 'กำลังจัดส่ง') {%>
    <div class="butt">
        <button onclick="success_order(event)">ส่งสินค้าสำเร็จ</button>
        <a href="/emp/myorders" class="cancel">กลับไปหน้าหลัก</a>
    </div>
    <%}%>
</div>
<div>
    <%if(data[0].order_status === 'จัดส่งสำเร็จ' || data[0].order_status === 'ปฏิเสธการรับออเดอร์') {%>
    <div class="butt">
        <a href="/emp/myorders" class="cancel">กลับไปหน้าหลัก</a>
    </div>
    <%}%>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const checkboxes = document.querySelectorAll(".check");
        const acceptButton = document.getElementById("acceptButton");
        function checkAllChecked() {
            const allChecked = [...checkboxes].every(input => input.checked);
            acceptButton.style.display = allChecked ? "" : "none";
        }
    
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener("change", checkAllChecked);
        });
    
        checkAllChecked();
    });
</script>


